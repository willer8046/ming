<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soo Design — 포트폴리오 게시판</title>
  <meta name="description" content="산뜻한 하늘색 톤의 유럽미장 인테리어 포트폴리오 게시판." />
  <meta name="theme-color" content="#87ceeb" />
  <style>
    :root{
      --bg:#f5fbff;--card:#fff;--text:#2f2f2f;--muted:#6d7a85;
      --primary:#5dade2;--primary-2:#a3d5f7;--ring:rgba(93,173,226,.4);
      --shadow:0 8px 22px rgba(0,0,0,.08);--radius:16px;--container:1120px
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans KR",Pretendard,ui-sans-serif,system-ui;color:var(--text);background:var(--bg)}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto;border-radius:12px}
    .container{width:min(100%,var(--container));margin-inline:auto;padding:20px}
    header{position:sticky;top:0;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);box-shadow:var(--shadow);z-index:50}
    nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo{width:28px;height:28px;border-radius:50%;background:var(--primary);box-shadow:0 6px 14px rgba(93,173,226,.4)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #e6eef5;background:#fff;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn.ghost{background:#f0f7fc}
    .btn.danger{border-color:#ffd5d5;background:#fff0f0}
    h1{font-size:clamp(24px,3.5vw,34px);margin:12px 0}
    .controls{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin:16px 0}
    .search{display:flex;align-items:center;gap:8px;padding:12px 14px;border-radius:12px;border:1px solid #e3edf6;background:#fff}
    input,select,textarea{width:100%;border:1px solid #e3edf6;border-radius:12px;padding:10px 12px;outline:none;background:#fff}
    input:focus,select:focus,textarea:focus{box-shadow:0 0 0 6px var(--ring);border-color:var(--primary-2)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{grid-column:span 4;background:var(--card);border:1px solid #f0f0f0;border-radius:14px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card .meta{padding:12px 14px}
    .card .title{font-weight:800}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:#eef7fd;border:1px solid #d9ecfb;font-size:12px;margin-right:6px}
    @media(max-width:980px){.card{grid-column:span 12}.controls{grid-template-columns:1fr}}
    .pager{display:flex;gap:6px;justify-content:center;margin:22px 0}
    .pager button{padding:8px 12px;border-radius:10px;border:1px solid #e3edf6;background:#fff;cursor:pointer}
    .pager .current{background:var(--primary);color:#fff;border-color:transparent}
    dialog{border:0;border-radius:20px;padding:0;max-width:min(920px,95vw);box-shadow:0 24px 60px rgba(0,0,0,.25)}
    .modal{display:grid;grid-template-columns:1.1fr .9fr;gap:18px;background:#fff;border-radius:20px;overflow:hidden}
    .modal .body{padding:18px}
    .close{position:absolute;top:10px;right:10px}
    @media(max-width:900px){.modal{grid-template-columns:1fr}}

    /* 관리자: 기본 숨김 */
    details.admin{display:none}
    /* 관리자 전용 UI 가시화 */
    .admin-tools{display:none;gap:8px;margin-top:10px}
    body.is-admin .admin-tools{display:flex}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">
          <span class="logo" aria-hidden="true"></span>
          <a href="index.html" aria-label="홈으로">Soo Design</a>
        </div>
        <div style="display:flex;gap:10px">
          <a class="btn ghost" href="index.html#work">← 홈페이지로</a>
          <!-- 관리자 로그인 버튼 -->
          <button class="btn" id="btn-admin-login">관리자 로그인</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="container" id="main">
    <h1>포트폴리오</h1>
    <p class="kicker" style="color:var(--muted)">완료/진행 프로젝트를 이미지 카드로 정리합니다. 상단 검색·필터를 이용해 빠르게 찾아보세요.</p>

    <div class="controls" role="region" aria-label="검색 및 필터">
      <div class="search" style="gap:10px">
        <input id="q" placeholder="프로젝트명, 설명, 태그 검색" aria-label="검색어" />
      </div>
      <select id="tag" aria-label="태그 필터"><option value="">전체 태그</option></select>
      <button class="btn" id="reset">초기화</button>
    </div>

    <section class="grid" id="grid" aria-live="polite"></section>
    <div class="pager" id="pager" role="navigation" aria-label="페이지 이동"></div>

    <!-- 관리자(로그인 후 노출) -->
    <details class="admin">
      <summary>관리자 모드(로컬 편집 → JSON 내보내기/가져오기)</summary>
      <div class="card" style="padding:16px">
        <div class="admin-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <h3 style="margin:6px 0">새 항목 추가</h3>
            <label>제목<input id="f-title"/></label>
            <label class="mt-2">설명<textarea id="f-desc" rows="3"></textarea></label>
            <label class="mt-2">태그(쉼표로 구분)<input id="f-tags" placeholder="카페, 리모델링"/></label>
            <label class="mt-2">대표 이미지 URL<input id="f-img" placeholder="https://...jpg"/></label>
            <label class="mt-2">상세 이미지 URL(줄바꿈으로 여러 개) <textarea id="f-gallery" rows="3" placeholder="https://...jpg
https://...jpg"></textarea></label>
            <button class="btn primary mt-2" id="add">추가</button>
          </div>
          <div>
            <h3 style="margin:6px 0">데이터 관리</h3>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn" id="export">JSON 내보내기</button>
              <label class="btn"><input id="import" type="file" accept="application/json" hidden/>JSON 가져오기</label>
              <button class="btn" id="clear">모든 항목 삭제(로컬)</button>
            </div>
            <p class="mt-2" style="color:var(--muted)">※ 편집 내용은 브라우저 <strong>localStorage</strong>에 임시 저장됩니다. 내보낸 JSON을 리포지토리에 <code>portfolio-data.json</code>으로 업로드하면 모든 사용자에게 동일하게 반영됩니다.</p>
          </div>
        </div>
      </div>
    </details>

    <!-- 상세 보기 모달 -->
    <dialog id="detail">
      <form method="dialog" style="position:relative">
        <button class="btn close" aria-label="닫기">닫기</button>
        <div class="modal">
          <div id="detail-gallery"></div>
          <div class="body">
            <h2 id="detail-title" style="margin:0 0 8px"></h2>
            <div id="detail-tags" style="margin-bottom:10px"></div>
            <p id="detail-desc" style="color:var(--muted)"></p>
            <div class="admin-tools">
              <button type="button" class="btn" id="btn-edit-in-detail">이 항목 수정</button>
              <button type="button" class="btn danger" id="btn-del-in-detail">삭제</button>
            </div>
          </div>
        </div>
      </form>
    </dialog>

    <!-- 수정 모달 -->
    <dialog id="edit">
      <form method="dialog" style="position:relative">
        <button class="btn close" aria-label="닫기">닫기</button>
        <div class="modal">
          <div class="body" style="grid-column: span 2">
            <h2 style="margin:0 0 8px">포트폴리오 수정</h2>
            <input type="hidden" id="e-id" />
            <label class="mt-2">제목<input id="e-title" /></label>
            <label class="mt-2">설명<textarea id="e-desc" rows="3"></textarea></label>
            <label class="mt-2">태그(쉼표로 구분)<input id="e-tags" /></label>
            <label class="mt-2">대표 이미지 URL<input id="e-cover" /></label>
            <label class="mt-2">상세 이미지 URL(줄바꿈으로 여러 개)<textarea id="e-gallery" rows="4"></textarea></label>
            <div style="display:flex;gap:8px;margin-top:12px">
              <button type="button" class="btn primary" id="e-save">저장</button>
              <button type="button" class="btn" id="e-cancel">취소</button>
            </div>
            <p class="kicker" style="color:var(--muted);margin-top:10px">저장하면 브라우저 <strong>localStorage</strong>에 반영됩니다. 모두에게 적용하려면 관리자 모드에서 <strong>JSON 내보내기</strong> 후 <code>portfolio-data.json</code>으로 업로드하세요.</p>
          </div>
        </div>
      </form>
    </dialog>
  </main>

  <script>
    // ===== 데이터 로딩 =====
    const seedData = [
      { id:1, title:"따뜻한 하늘톤 카페 리모델링", desc:"유럽미장 질감 위에 하늘색 포인트를 더해 밝고 산뜻한 무드 연출.", tags:["카페","리모델링"], cover:"https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1200&auto=format&fit=crop", gallery:["https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1200&auto=format&fit=crop"] },
      { id:2, title:"모던 주거 인테리어", desc:"화이트&스카이블루 팔레트와 곡선 가구로 부드러운 동선.", tags:["주거","리빙"], cover:"https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?q=80&w=1200&auto=format&fit=crop", gallery:["https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?q=80&w=1200&auto=format&fit=crop"] },
      { id:3, title:"브런치 레스토랑", desc:"밝은 톤 목재와 하늘색 포인트 벽으로 청량한 분위기 구현.", tags:["상업","레스토랑"], cover:"https://images.unsplash.com/photo-1550985607-b283cf7247d2?q=80&w=1200&auto=format&fit=crop", gallery:["https://images.unsplash.com/photo-1550985607-b283cf7247d2?q=80&w=1200&auto=format&fit=crop"] }
    ];

    const KEY = "soodesign-portfolio";
    let items = [];
    let currentDetailId = null;

    async function loadData(){
      try {
        const res = await fetch("portfolio-data.json", {cache: "no-store"});
        items = res.ok ? await res.json() : seedData;
      } catch(_) { items = seedData; }
      const local = localStorage.getItem(KEY);
      if(local){ try { items = JSON.parse(local); } catch(_){} }
      items.forEach((it,i)=>{ if(!it.id) it.id = i+1; if(!it.tags) it.tags=[]; if(!it.gallery) it.gallery=[it.cover].filter(Boolean); });
    }
    function saveLocal(){ localStorage.setItem(KEY, JSON.stringify(items)); }

    // ===== 렌더링 =====
    const grid = document.getElementById('grid');
    const pager = document.getElementById('pager');
    const q = document.getElementById('q');
    const tagSel = document.getElementById('tag');

    const pageSize = 9; let page = 1;

    function uniqueTags(list){ return Array.from(new Set(list.flatMap(i=>i.tags||[]))); }

    function filterItems(){
      const s = (q.value||"").trim().toLowerCase();
      const t = tagSel.value;
      return items.filter(it=>{
        const hay = (it.title + " " + (it.desc||"") + " " + (it.tags||[]).join(" ")).toLowerCase();
        const okText = !s || hay.includes(s);
        const okTag = !t || (it.tags||[]).includes(t);
        return okText && okTag;
      });
    }

    function renderTags(){
      const tags = uniqueTags(items);
      tagSel.innerHTML = '<option value="">전체 태그</option>' + tags.map(t=>`<option value="${t}">${t}</option>`).join('');
    }

    function escapeHTML(s){
      return (s||'').replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    }

    function isAdmin(){ return sessionStorage.getItem(SESSION_OK) === '1'; }

    function cardHTML(it){
      return `<article class="card">
        ${it.cover? `<img src="${it.cover}" alt="${escapeHTML(it.title)} 대표 이미지" loading="lazy"/>`:''}
        <div class="meta">
          <div class="title">${escapeHTML(it.title)}</div>
          <p style="color:var(--muted);margin:6px 0 10px">${escapeHTML(it.desc||'')}</p>
          <div>${(it.tags||[]).map(t=>`<span class="pill">#${escapeHTML(t)}</span>`).join('')}</div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" data-id="${it.id}" data-open>자세히 보기</button>
            ${isAdmin()? `<div class="admin-tools" style="display:flex;"><button class="btn" data-id="${it.id}" data-edit>수정</button><button class="btn danger" data-id="${it.id}" data-del>삭제</button></div>`:''}
          </div>
        </div>
      </article>`;
    }

    function render(){
      const list = filterItems();
      const total = Math.max(1, Math.ceil(list.length / pageSize));
      if(page>total) page = total;
      const start = (page-1)*pageSize;
      const slice = list.slice(start, start+pageSize);
      grid.innerHTML = slice.map(cardHTML).join('') || `<div class="card" style="grid-column:span 12;padding:18px">검색 결과가 없습니다.</div>`;
      let html = '';
      for(let i=1;i<=total;i++){ html += `<button ${i===page? 'class="current"':''} data-pg="${i}">${i}</button>`; }
      pager.innerHTML = html;
    }

    // ===== 상세 모달 =====
    const detail = document.getElementById('detail');
    const dTitle = document.getElementById('detail-title');
    const dDesc = document.getElementById('detail-desc');
    const dTags = document.getElementById('detail-tags');
    const dGallery = document.getElementById('detail-gallery');

    function openDetail(id){
      const it = items.find(x=>String(x.id)===String(id));
      if(!it) return;
      currentDetailId = it.id;
      dTitle.textContent = it.title;
      dDesc.textContent = it.desc||'';
      dTags.innerHTML = (it.tags||[]).map(t=>`<span class="pill">#${escapeHTML(t)}</span>`).join('');
      dGallery.innerHTML = (it.gallery&&it.gallery.length? it.gallery: [it.cover].filter(Boolean)).map((src,i)=>`<img src="${src}" alt="${escapeHTML(it.title)} 상세 이미지 ${i+1}" loading="lazy"/>`).join('');
      detail.showModal();
      // 상세 내부 관리자 버튼
      document.getElementById('btn-edit-in-detail').style.display = is()? 'inline-flex':'none';
      document.getElementById('btn-del-in-detail').style.display = is()? 'inline-flex':'none';
    }

    // ===== 수정 모달 =====
    const edit = document.getElementById('edit');
    const eId = document.getElementById('e-id');
    const eTitle = document.getElementById('e-title');
    const eDesc = document.getElementById('e-desc');
    const eTags = document.getElementById('e-tags');
    const eCover = document.getElementById('e-cover');
    const eGallery = document.getElementById('e-gallery');

    function openEdit(id){
      const it = items.find(x=>String(x.id)===String(id));
      if(!it) return;
      eId.value = it.id;
      eTitle.value = it.title || '';
      eDesc.value = it.desc || '';
      eTags.value = (it.tags || []).join(', ');
      eCover.value = it.cover || '';
      eGallery.value = (it.gallery || []).join('\n');
      edit.showModal();
    }

    function applyEdit(){
      const id = eId.value;
      const idx = items.findIndex(x=>String(x.id)===String(id));
      if(idx<0) return alert('항목을 찾을 수 없습니다.');
      const tags = eTags.value.split(',').map(s=>s.trim()).filter(Boolean);
      const gallery = eGallery.value.split('\n').map(s=>s.trim()).filter(Boolean);
      items[idx] = {
        ...items[idx],
        title: eTitle.value.trim(),
        desc: eDesc.value.trim(),
        tags,
        cover: eCover.value.trim(),
        gallery: gallery.length? gallery : (eCover.value.trim()? [eCover.value.trim()] : items[idx].gallery || [])
      };
      saveLocal();
      renderTags();
      render();
      detail.open && openDetail(id); // 상세창 열려있으면 갱신
      edit.close();
      alert('수정되었습니다. (로컬 저장) JSON 내보내기로 배포용 파일을 갱신하세요.');
    }

    function deleteItem(id){
      if(!confirm('정말 삭제하시겠습니까?')) return;
      const idx = items.findIndex(x=>String(x.id)===String(id));
      if(idx<0) return;
      items.splice(idx,1);
      saveLocal();
      renderTags();
      render();
      detail.close();
      alert('삭제되었습니다. (로컬 저장) JSON 내보내기로 배포용 파일을 갱신하세요.');
    }

    // ===== 이벤트 바인딩 =====
    q.addEventListener('input', ()=>{ page=1; render(); });
    tagSel.addEventListener('change', ()=>{ page=1; render(); });
    document.getElementById('reset').addEventListener('click', ()=>{ q.value=''; tagSel.value=''; page=1; render(); });
    pager.addEventListener('click', (e)=>{ const btn=e.target.closest('button[data-pg]'); if(!btn) return; page=Number(btn.dataset.pg); render(); });
    grid.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('button[data-open]');
      const editBtn = e.target.closest('button[data-edit]');
      const delBtn = e.target.closest('button[data-del]');
      if(openBtn) openDetail(openBtn.dataset.id);
      if(editBtn && isAdmin()) openEdit(editBtn.dataset.id);
      if(delBtn && isAdmin()) deleteItem(delBtn.dataset.id);
    });
    document.getElementById('btn-edit-in-detail').addEventListener('click', ()=>{ if(currentDetailId) openEdit(currentDetailId); });
    document.getElementById('btn-del-in-detail').addEventListener('click', ()=>{ if(currentDetailId) deleteItem(currentDetailId); });
    document.getElementById('e-save').addEventListener('click', applyEdit);
    document.getElementById('e-cancel').addEventListener('click', ()=>edit.close());

    // ===== 관리자 로그인(버튼으로만 실행) =====
    // 관리자 비밀번호 검증 (SALT + PASSWORD 의 SHA-256)
    const ADMIN_HASH = "7e224edda74c33886fbc3fa9a14c97ff2681f0862587ee99f91169489c59ef07"; // "soodesign-v1" + "Rksqn23#"
    const SALT = "soodesign-v1";
    const SESSION_OK = "soodesign-admin-ok";

    async function sha256Hex(str){
      const enc=new TextEncoder().encode(str);
      const buf=await crypto.subtle.digest('SHA-256',enc);
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function showAdmin(){
      const el=document.querySelector('details.admin');
      if(el) el.style.display='block';
      document.body.classList.add('is-admin');
      render(); // 카드에 수정/삭제 버튼 반영
    }
    async function adminLogin(){
      const pw=prompt('관리자 비밀번호를 입력하세요:');
      if(!pw) return;
      const digest=await sha256Hex(SALT+pw);
      if(digest===ADMIN_HASH){
        sessionStorage.setItem(SESSION_OK,'1');
        showAdmin();
        alert('관리자 모드가 활성화되었습니다.');
      } else {
        alert('비밀번호가 올바르지 않습니다.');
      }
    }

    document.getElementById('btn-admin-login').addEventListener('click', adminLogin);

    // 이미 로그인된 세션이면 자동 표시(팝업 없음)
    if(sessionStorage.getItem(SESSION_OK)==='1'){ showAdmin(); }

    // ===== 초기화 =====
    (async()=>{ await loadData(); renderTags(); render(); })();
    
    // ===== 관리자 모드: 추가/가져오기/내보내기/초기화 =====
    document.getElementById('add').addEventListener('click', ()=>{
      if(!isAdmin()) return alert('관리자 모드에서만 가능합니다.');
      const t = document.getElementById('f-title').value.trim();
      if(!t) return alert('제목을 입력하세요');
      const desc = document.getElementById('f-desc').value.trim();
      const tags = document.getElementById('f-tags').value.split(',').map(s=>s.trim()).filter(Boolean);
      const cover = document.getElementById('f-img').value.trim();
      const gallery = document.getElementById('f-gallery').value.split('\n').map(s=>s.trim()).filter(Boolean);
      const id = Date.now();
      items.unshift({id,title:t,desc,tags,cover,gallery:gallery.length?gallery:(cover?[cover]:[])});
      saveLocal(); renderTags(); render();
      alert('추가되었습니다. (로컬 저장) JSON 내보내기로 배포용 파일을 갱신하세요.');
    });

    document.getElementById('export').addEventListener('click', ()=>{
      if(!isAdmin()) return alert('관리자 모드에서만 가능합니다.');
      const blob = new Blob([JSON.stringify(items,null,2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'portfolio-data.json'; a.click(); URL.revokeObjectURL(a.href);
    });

    document.getElementById('import').addEventListener('change', (e)=>{
      if(!isAdmin()) return alert('관리자 모드에서만 가능합니다.');
      const file = e.target.files[0]; if(!file) return;
      const fr = new FileReader();
      fr.onload = ()=>{
        try { items = JSON.parse(fr.result); saveLocal(); renderTags(); render(); alert('가져오기 완료(로컬 저장됨). 내보내기 후 repo에 업로드하세요.'); }
        catch(err){ alert('JSON 형식 오류'); }
      };
      fr.readAsText(file);
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      if(!isAdmin()) return alert('관리자 모드에서만 가능합니다.');
      if(!confirm('로컬 데이터를 모두 삭제할까요?')) return;
      localStorage.removeItem(KEY); items = seedData.slice(); renderTags(); render();
    });
  </script>
</body>
</html>
